---
title: 加密的那些事
date: 2024-05-31 10:20:16
permalink: /pages/07c91f/
titleTag: 原创
categories:
  - 技术
  - 心得
tags:
  - 
author: 
  name: Regulus
  link: https://github.com/linxi0551
---

::: tip 序言

不论是前端还是后端开发中，数字签名、信息加密是经常需要使用到的技术，应用场景包括了用户登入、交易、信息通讯、OAuth 等等，不同的应用场景也会需要使用到不同的签名加密算法，或者需要搭配不一样的 签名加密算法 来达到业务目标。

:::
<!-- 
[幻灯片模式](/slides/slides.html) -->
[幻灯片模式](/pages/07c911/)

<!-- <script>
  window.location.href = '/slides/slides.html';
</script> -->

## 历史上的密码

<!-- **漫画**：https://cloud.tencent.com/developer/article/1394806 -->

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/04/zbw5goanfw.jpg' width="700" style="cursor: zoom-in;"></p>

早在古罗马时期，加密算法就被应用于战争当中。 在大规模的战争中，部队之间常常需要信使往来，传递重要的军事情报。 

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/s81l0wvnzd.jpg' width="700" style="cursor: zoom-in;"></p>

可是，一旦信使被敌军抓获，重要的军事情报就完全暴露给了敌方。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/thtjd7mn2l.jpg' width="700" style="cursor: zoom-in;"></p>

甚至，狡猾的敌人有可能篡改军事情报，并收买信使把假情报传递给我方部队。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/5rl2i6buw1.jpg' width="700" style="cursor: zoom-in;"></p>

<!-- <p class="centered"><img src='https://ask.qcloudimg.com/http-save/yehe-2960417/5rl2i6buw1.jpeg?imageView2/2/w/1620' width="700" style="cursor: zoom-in;"></p> -->

### 凯撒密码

传送情报过程中，容易遭到**中间人攻击**，怎样防止这种情况的发生呢？ 古罗马时期，凯撒大帝想出了一种非常朴素的加密方法，这套加密方法也被后世称为**凯撒密码**。加密的原理就像下图这样： 

<p class="centered"><img src='https://ask.qcloudimg.com/http-save/yehe-2960417/ltlt3t6nuf.png?imageView2/2/w/1620' width="700" style="cursor: zoom-in;"></p>


原理其实非常简单，就是把字母表进行**移位加密**，比如将字母表中的 A 移位加密后变成 C，将字母表中的 B 移位加密后变成 D，以此类推。

<center><strong><big> 下面是更直观的示例 </big></strong></center>

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/_20240603113844.png' width="620" style="cursor: zoom-in;"></p>

**凯撒密码**在当时是一种有效的加密方法，它是典型的**对称加密**算法，它的加密和解密密钥用的都是同一个密钥，加密的时候字母表平移了几位，解密的时候只要反向平移就能得到原文。

这也导致凯撒密码的**安全性较低**，因为只需尝试26个不同的位移就能<span style="color:red;">暴力破解</span>。

<center><strong><big> 下面是暴力破解凯撒密码的示例 </big></strong></center>

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/_20240603140434.png' width="620" style="cursor: zoom-in;"></p>


## 计算机时代的密码

现代加密技术在凯撒密码的基础上进行了改进，采用了更复杂的加密算法，如**对称加密（AES、DES）**和**非对称加密（RSA）**。


### 二进制编码

学过计算机的都知道，在计算机的世界，所有数据都是以二进制的形式存储的，计算机的运算都是基于二进制的，每个字母当然也是一串二进制数字。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/_20240603145534.png' width="620" style="cursor: zoom-in;"></p>



<!-- 为什么讲这个，是因为字母是没办法做数学计算的，没办法做加减乘除，但是只要把它转换成编码变成了数字，那么它就能进行简单的数学运算。 -->

### 异或运算

**异或运算**(`XOR`)是一种常见的位操作运算,相同位为0，不同位为1。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/_20240603154039.png' width="350" style="cursor: zoom-in;"></p>


**异或运算**有一个非常好的性质，它的性质就是下面这张图

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/_20240603171743.png' width="350" style="cursor: zoom-in;"></p>

上图中`A`可以理解为**明文**，`B`可以理解为**密钥**，`A`和`B`异或，那么`A`和`B`异或得到的结果就是**密文**。反之，**密文**和**密钥**进行异或，那么得到的结果就是**明文**`A`。

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/03/_20240603175831.png' width="700" style="cursor: zoom-in;"></p>

上图中字母`D`可以理解为**明文**，蒙版可以理解为**密钥**，`D`和蒙版做异或运算，就会得到一张没有任何信息的图，也就是**密文**。

解密时只要把得到的**密文**和蒙版做异或运算就能得到了字母`D`也就是**明文**。这就是对称加密算法的基本原理。

现在用的比较多的对称加密算法有`DES`、`3DES`和`AES`，这两个算法都是把明文切成固定的比特长度大小，再进行复杂的位运算加密，和上面说过的**凯撒密码**类似，当然会比**凯撒密码**更复杂些，然后把加密后的结果再和密钥做一个异或运算，这样就可以获得加密后的密文。

::: warning 
在安全方面，更加推荐使用`AES`,`DES`现在已经被破解了，但由于`DES`很早就被广泛应用，现在一些老旧设备的系统还是使用`DES`加密，尤其是在金融和政府机构的遗留系统中。
:::

### 分组密码模式

分组密码模式，是指将明文分成固定长度的分组，然后对每个分组进行加密，最后将加密后的分组密文拼接起来，这样加密后的密文长度和明文长度相同。

常见的分组密码模式有五种，分别是：**电码本模式（ECB模式）**、**密码分组链接模式（CBC模式）**、**密文反馈模式（CFB）**、**计数器模式（CTR模式）**、**输出反馈模式（OFB）**。

#### 电码本模式（ECB模式）

::: details 描述

**电码本模式**的名称来源于其工作原理与传统纸质电话簿的类比。在传统的电话簿中，联系人姓名 **（类似于明文）** 与对应的电话号码 **（可类比为密文）** 是按字母顺序排列的，每个人（或每个条目）的电话号码都是独立记录的，相互之间没有关联。当你查找某个人的电话号码时，可以直接定位到该姓名对应的条目，而不需要了解或参考其他人的信息。

相似地，在**ECB加密模式**中，明文被切分为若干个数据块，每个数据块独立地通过相同的密钥和加密算法转换成相应的密文块，这些密文块之间也是**独立且无关联**的，就像电话簿中的每个条目独立记录一样。因此，这种 **"一对一"** 映射的加密方式与电话簿的使用方式相类似，故被称为“电码本”模式。

:::


<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/04/_20240604155659.png' width="700" style="cursor: zoom-in;"></p>

从上图中可以看到每个数据块都是**独立加密**的，块与块之间不存在任何联系，所以加密的时候可**并行**加密，速度非常快，而且实现也简单。这种模式适用于**无重复数据**的短消息加密场景。这是**ECB模式**的优点。

那这个模式有什么缺点呢，可以看下下面这个例子👇：

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/07/fda187c5d4bf9d3f01f9e3d35d12742.png' width="700" style="cursor: zoom-in;"></p>

在这个场景中我们可以将付款人银行账号、收款人银行账号和转账金额进行分组，得到明文分组1、2、3的16进制表示的ASCII码序列，通过分组加密后得到分组密文，这时候只知道密文分组1是付款人、密文分组2是收款人、密文分组3是转账金额。至于具体的内容并不知道，因为进行了加密。


:::  warning 如果这个时候有黑客攻击，他会用什么手段进行攻击呢？
:::

::: details
其实很简单，可以看下面这副图👇：

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/07/7f96709cce53a75294af2e76e7d5446.png' width="700" style="cursor: zoom-in;"></p>

攻击者并不需要密钥解密密文，就可以直接操作密文从而影响明文，只要对密文块进行**重新排序**，就能让解密后的付款人和收款人的顺序进行互换，这对银行转账业务来说是致命的。

这就是ECB模式的重要缺陷之一，它**缺乏扩散性**，每个数据块独立加密，彼此之间不存在关联，容易被密文**重排序**攻击。并且相同的明文无论出现在哪个位置都会被**加密成相同的密文**，这导致它模式是**可预测性**的。

那有什么办法解决这个问题呢？答案是下面的模式👇。

:::


#### 密码分组链接模式（CBC模式）

::: details 描述

**密码分组链接模式**得名于其特有的工作原理，即每个明文分组在加密之前会与前一个密文分组进行 **"链接"**（通常是异或操作）。这个 **"链接"** 过程确保了当前分组的加密不仅依赖于当前分组的明文和密钥，还依赖于前一个分组的加密结果，形成了 **"链式"** 反应，故此得名**密码分组链接模式**。

:::

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/07/_20240607101439.png' width="700" style="cursor: zoom-in;"></p>

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/07/88e3616a82c8ad93f1be7a0a756e609.png' width="700" style="cursor: zoom-in;"></p>

上图是**CBC模式**加解密过程，我们可以拆分成以下几个步骤👇：

加密的过程：

::: details

1. 首先将明文切成若干组。

2. 在开始加密前，明文分组1先和初始向量进行异或运算（这里的初始向量是一个随机数，用于确保相同的明文在每次加密时生成不同的密文）。

3. 再用密钥对明文分组1和初始向量异或的结果进行加密，得到密文分组1。

4. 用密文分组1和明文分组2进行异或运算，异或完后再进行加密得到密文分组2。

5. 同样的用密文分组2和明文分组3进行异或运算，异或完后再进行加密得到密文分组3，以此类推。

:::


解密的过程：

::: details

1. 首先拿密文分组1来解密。

2. 密文分组1解密得到的结果和初始化向量做异或运算，就得到明文分组1。

3. 密文分组2进行解密。

4. 密文分组2解密得到的结果和密文分组1做异或运算，就得到明文分组2，以此类推。

:::

这种**依赖**前一个密文分组进行的异或运算就叫做**CBC模式**，这种模式有个好处就是即使相同的明文块在不同位置或不同消息中也会**产生不同的密文块**，并且**具备数据完整保护性**。适用于常规**文件加密**，**非实时**加密场景。

之前通过**重排序**攻击的手段，明显对这种模式是无效的，因为会导致密文块的**顺序**被**破坏**，从而导致解密失败。

但是**CBC模式**也不是无懈可击，可以看下面这张图👇：

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/07/e945024575166790bc0d03a3374788a.png' width="700" style="cursor: zoom-in;"></p>

从图中可以看到攻击者截获了初始化向量，并对它的某一比特位进行了反转，那么解密后的第一个明文块的相应比特位也会被**反转**。<mark><span style="color:red;">也就是说攻击者可以通过操作初始化向量来影响明文，并且不需要密钥</span></mark>，这就是**CBC模式**的缺陷所在。

::: tip 那有什么办法解决这个问题呢？答案是<mark>CFB模式</mark>。
:::


#### 密文反馈模式（CFB）

::: details 描述

密文反馈模式是一种将块密码转换为流密码的操作模式，使其能够加密任意长度的数据。它结合了分组密码和流密码的特性，允许分组密码像流密码一样一次处理一位或一个字节的数据。

:::

<p class="centered"><img src='https://tuchuang.voooe.cn/images/2024/06/07/4a00827a6a0f293a181bb0933d38c89.png' width="650" style="cursor: zoom-in;"></p>

**CFB模式**它直接对初始化向量进行加密，加密完的结果跟明文分组1做异或操作，得出密文分组1，密文分组1进行加密后和明文分组2进行异或操作，得出密文分组2，以此类推。

# 常见的加密算法介绍

> 常见的加密算法可以大致分为：对称加密算法、非对称加密算法、摘要算法。接下来主要围绕这三种算法进行介绍。

## 对称加密算法（Symmetric-key algorithm） 

> 常见的 **对称加密** 算法主要有 `DES`、`3DES`、`AES` 等 

### 原理

![](https://ask.qcloudimg.com/http-save/yehe-2960417/khb2j1eb0c.png?imageView2/2/w/1620)



### 讲解常见的集中算法

> AES、DES、3DES、Blowfish、IDEA、RC4、RC5、RC6 

### 常见对称加密算法的原理

- DES （Data Encryption Standard） 

  >数字加密算法是1977年美国联邦信息处理标准（FIPS）中所采用的一种对称密码。DES一直以来被美国以及其它国家的政府和银行等广泛使用。DES运算速度快、资源消耗较少，但是随着计算机计算能力的增强，DES已经能够在短时间内暴力破解，安全性较低。RSA公司在20世纪末举办过的破译DES密钥的比赛数据显示，到1999年破译密钥只需要22小时15分钟。鉴于DES已经能够在短时间内被破解，现在除了破解之前的密文，已不再推荐使用。 

- 3DES（Triple Data Encryption Algorithm） 

  > 由于DES已经能够在短时间内被破解，为了增加DES的强度，将DES重复3次的用来替代DES的分组密码3DES被开发出来，也称为TDEA（Triple Data Encryption Algorithm）。 
  >
  > 但是，3DES处理速度不高，除了在一些重视向下兼容性的环境中，很少有新的用途，也逐渐被AES所取代。 

  

- AES （Advanced Encryption Standard） 

  > 高级加密标准是取代DES标准的一种对称加密算法的新标准，最终在2000年从众多候选对称密码算法中选出了Rijndael作为AES。被选为AES的密码算法必须满足一定的条件，比如，算法没有弱点、加密以及密钥准备的速度要够快、实现容易、能够在各平台上有效工，同时，还必须无条件地免费供全世界使用。可以说，被选为AES的算法近乎“完美”。AES加解密机制较复杂，综合运用了逐字节替换、平移行、混合列、与轮密钥进行XOR等，其优点在运算速度快、资源消耗少，且安全性高。
  >
  > 前面我们简单介绍了DES、3DES和AES三种对称密码，DES已经能够被暴力破解，3DES也逐渐被AES取代。鉴于AES在其选定过程中经过了全世界密码专家的严谨验证，一般来说，我们在使用的时候应尽量使用AES。

### 优点与缺点

- 优点：对称加密算法的优点是算法公开、计算量小、加密速度快、加密效率高。
- 缺点：秘钥的管理和分发非常困难，不够安全。在数据传送前，发送方和接收方必须商定好秘钥，然后双方都必须要保存好秘钥，如果一方的秘钥被泄露，那么加密信息也就不安全了。另外，每对用户每次使用对称加密算法时，都需要使用其他人不知道的唯一秘钥，这会使得收、发双方所拥有的钥匙数量巨大，密钥管理成为双方的负担。

### 用途与场景

- 通信过程中的加密 
- 数据库存储的敏感信息加密【一般用于保存用户手机号、身份证等敏感但能解密的信息 】

### 思考

​	*在对称加密中，我们应该如何将密钥安全地发送给接收者?* 

## 非对称加密算法


> **非对称加密算法**，又称为 **公开密钥加密算法**。它需要两个密钥，一个称为 **公开密钥** (`public key`)，即 **公钥**，另一个称为 **私有密钥** (`private key`)，即 **私钥**。
>
> 因为 **加密** 和 **解密** 使用的是两个不同的密钥，所以这种算法称为 **非对称加密算法**
>
> 常见的 **非对称算法** 主要有 `RSA`、`DSA`、`ECC  ` 等 
>
> 1. 如果使用 **公钥** 对数据 **进行加密**，只有用对应的 **私钥** 才能 **进行解密**。
> 2. 如果使用 **私钥** 对数据 **进行加密**，只有用对应的 **公钥** 才能 **进行解密**。
>

### 一点历史

1976年以前，所有的加密方法都是同一种模式： 

> 1. 甲方选择某一种加密规则，对信息进行加密
>
> 　2. 乙方使用同一种规则，对信息进行解密

由于加密和解密使用同样规则（简称"密钥"），这被称为["对称加密算法"](http://zh.wikipedia.org/zh-cn/%E5%AF%B9%E7%AD%89%E5%8A%A0%E5%AF%86)（Symmetric-key algorithm）。

这种加密模式有一个最大弱点：甲方必须把加密规则告诉乙方，否则无法解密。保存和传递密钥，就成了最头疼的问题。

![](http://www.ruanyifeng.com/blogimg/asset/201306/bg2013062703.jpg)

1976年，两位美国计算机学家Whitfield Diffie 和 Martin Hellman，提出了一种崭新构思，可以在不直接传递密钥的情况下，完成解密。这被称为["Diffie-Hellman密钥交换算法"](http://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange)。这个算法启发了其他科学家。人们认识到，加密和解密可以使用不同的规则，只要这两种规则之间存在某种对应关系即可，这样就避免了直接传递密钥。

这种新的加密模式被称为"非对称加密算法"。

> 　　（1）乙方生成两把密钥（公钥和私钥）。公钥是公开的，任何人都可以获得，私钥则是保密的。
>
> 　　（2）甲方获取乙方的公钥，然后用它对信息加密。
>
> 　　（3）乙方得到加密后的信息，用私钥解密。

如果公钥加密的信息只有私钥解得开，那么只要私钥不泄漏，通信就是安全的。 

![](http://www.ruanyifeng.com/blogimg/asset/201306/bg2013062702.jpg)

1977年，三位数学家Rivest、Shamir 和 Adleman 设计了一种算法，可以实现非对称加密。这种算法用他们三个人的名字命名，叫做[RSA算法](http://zh.wikipedia.org/zh-cn/RSA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95)。从那时直到现在，RSA算法一直是最广为使用的"非对称加密算法"。毫不夸张地说，只要有计算机网络的地方，就有RSA算法。

这种算法非常[可靠](http://en.wikipedia.org/wiki/RSA_Factoring_Challenge)，密钥越长，它就越难破解。根据已经披露的文献，目前被破解的最长RSA密钥是768个二进制位。也就是说，长度超过768位的密钥，还无法破解（至少没人公开宣布）。因此可以认为，1024位的RSA密钥基本安全，2048位的密钥极其安全。

### 原理【着重探讨】

非对称加密算法是一种密钥的保密方法。非对称加密算法需要两个密钥：公开密钥（publickey）和私有密钥（privatekey）。公开密钥与私有密钥是一对，如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密。因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。

非对称加密算法实现机密信息交换的基本过程是：甲方生成一对密钥并将其中的一把作为公用密钥向其它方公开；得到该公用密钥的乙方使用该密钥对机密信息进行加密后再发送给甲方；甲方再用自己保存的另一把专用密钥对加密后的信息进行解密。

![](D:\emsoft\5-24分享会\rsa颜色.gif)

### 优点与缺点

- 优点：安全
- 缺点：速度较慢 

### 用途与场景

* 数字签名
* 加密

> 既然是加密，那肯定是不希望别人知道我的消息，所以只有我才能解密，所以可得出公钥负责加密，私钥负责解密；
>
> 既然是签名，那肯定是不希望有人冒充我发消息，只有我才能发布这个签名，所以可得出私钥负责签名，公钥负责验证。

##  哈希算法


> 百度百科：Hash，一般翻译做散列、杂凑，或音译为哈希，是把任意长度的[输入](https://baike.baidu.com/item/%E8%BE%93%E5%85%A5/5481954)（又叫做预映射pre-image）通过散列算法变换成固定长度的[输出](https://baike.baidu.com/item/%E8%BE%93%E5%87%BA/11056752)，该输出就是散列值。这种转换是一种压缩映射，也就是，散列值的空间通常远小于输入的空间，不同的输入可能会散列成相同的输出，所以不可能从散列值来确定唯一的输入值。简单的说就是一种将任意长度的消息压缩到某一固定长度的[消息摘要](https://baike.baidu.com/item/%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81/4547744)的函数。 
>
> **散列算法** 主要有 `SHA-1`、`MD5` 等  

### 原理

> 将任意长度的二进制值映射为较短的固定长度的二进制值，这个短的二进制值称为哈希值，这个算法具有不可逆、碰撞低等特性。同时该类算法可以用作数字签名，用来证实某个信息确实是由某个人发出的，同时可以保证信息没有被修改。 

### 哈希算法简单介绍【是什么、作用】

先举个例子。我们每个活在世上的人，为了能够参与各种社会活动，都需要一个用于识别自己的标志。也许你觉得名字或是身份证就足以代表你这个人，但是这种代表性非常脆弱，因为重名的人很多，身份证也可以伪造。最可靠的办法是把一个人的所有基因序列记录下来用来代表这个人，但显然，这样做并不实际。而指纹看上去是一种不错的选择，虽然一些专业组织仍然可以模拟某个人的指纹，但这种代价实在太高了。

而对于在互联网世界里传送的文件来说，如何标志一个文件的身份同样重要。比如说我们下载一个文件，文件的下载过程中会经过很多网络服务器、路由器的中转，如何保证这个文件就是我们所需要的呢？我们不可能去一一检测这个文件的每个字节，也不能简单地利用文件名、文件大小这些极容易伪装的信息，这时候，我们就需要一种指纹一样的标志来检查文件的可靠性，这种指纹就是我们现在所用的Hash算法(也叫散列算法)。

**散列算法（Hash Algorithm）**，又称哈希算法，杂凑算法，是一种从任意文件中创造小的数字「指纹」的方法。与指纹一样，散列算法就是一种以较短的信息来保证文件唯一性的标志，这种标志与文件的每一个字节都相关，而且难以找到逆向规律。因此，当原有文件发生改变时，其标志值也会发生改变，从而告诉文件使用者当前的文件已经不是你所需求的文件。

这种标志有何意义呢？之前文件下载过程就是一个很好的例子，事实上，现在大部分的网络部署和版本控制工具都在使用散列算法来保证文件可靠性。而另一方面，我们在进行文件系统同步、备份等工具时，使用散列算法来标志文件唯一性能帮助我们减少系统开销，这一点在很多云存储服务器中都有应用。

![以Git为代表的众多版本控制工具都在使用SHA1等散列函数检查文件更新 ](https://upload-images.jianshu.io/upload_images/298426-f2f1f4f9f37e28a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp)

当然，作为一种指纹，散列算法最重要的用途在于给证书、文档、密码等高安全系数的内容添加加密保护。这一方面的用途主要是得益于散列算法的**不可逆性**，这种不可逆性体现在，你不仅不可能根据一段通过散列算法得到的指纹来获得原有的文件，也不可能简单地创造一个文件并让它的指纹与一段目标指纹相一致。散列算法的这种不可逆性维持着很多安全框架的运营。

### 常见的散列算法

- MD5算法

  > `MD5` 用的是 **哈希函数**，它的典型应用是对一段信息产生 **信息摘要**，以 **防止被篡改**。严格来说，`MD5` 不是一种 **加密算法** 而是 **摘要算法**。无论是多长的输入，`MD5` 都会输出长度为 `128bits` 的一个串 (通常用 `16` **进制** 表示为 `32` 个字符)。 

- SHA1算法

  > `SHA1` 是和 `MD5` 一样流行的 **消息摘要算法**，然而 `SHA1` 比 `MD5` 的 **安全性更强**。对于长度小于 `2 ^ 64` 位的消息，`SHA1` 会产生一个 `160` 位的 **消息摘要**。基于 `MD5`、`SHA1` 的信息摘要特性以及 **不可逆** (一般而言)，可以被应用在检查 **文件完整性** 以及 **数字签名** 等场景。

- HMAC算法
  >`HMAC` 是密钥相关的 **哈希运算消息认证码**（Hash-based Message Authentication Code），`HMAC` 运算利用 **哈希算法** (`MD5`、`SHA1` 等)，以 **一个密钥** 和 **一个消息** 为输入，生成一个 **消息摘要** 作为 **输出**。
  >
  >`HMAC` **发送方** 和 **接收方** 都有的 `key` 进行计算，而没有这把 `key` 的第三方，则是 **无法计算** 出正确的 **散列值**的，这样就可以 **防止数据被篡改**。

### 两个特性

- 不同的输入一定得出不同的 hash 值 
- 无法从 hash 值倒推出原来的输入 

### 用途与场景

- 保护数据

  > 散列值可用于唯一地识别机密信息。这需要散列函数是抗碰撞(collision-resistant)的，意味着很难找到产生相同散列值的数据。散列函数分类为密码散列函数和可证明的安全散列函数。第二类中的函数最安全，但对于大多数实际目的而言也太慢。透过生成非常大的散列值来部分地实现抗碰撞。例如，SHA-2是最广泛使用的密码散列函数之一，它生成256比特值。

- 文件校验

  >我们比较熟悉的校验算法有[奇偶校验](https://baike.baidu.com/item/%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C)和CRC校验，这2种校验并没有抗[数据篡改](https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E7%AF%A1%E6%94%B9)的能力，它们一定程度上能检测并纠正数据传输中的信道误码，但却不能防止对数据的恶意破坏。
  >
  >MD5 Hash算法的"数字指纹"特性，使它成为应用最广泛的一种文件完整性[校验和](https://baike.baidu.com/item/%E6%A0%A1%E9%AA%8C%E5%92%8C)(Checksum)算法，不少Unix系统有提供计算md5 checksum的命令。

- 数字签名

  > Hash 算法也是现代密码体系中的一个重要组成部分。由于非对称算法的运算速度较慢，所以在数字签名协议中，单向散列函数扮演了一个重要的角色。对 Hash 值，又称"数字摘要"进行数字签名，在统计上可以认为与对文件本身进行数字签名是等效的。而且这样的协议还有其他的优点。

- 语音识别

  > 对于像从一个已知列表中匹配一个MP3文件这样的应用，一种可能的方案是使用传统的散列函数——例如[MD5](https://zh.wikipedia.org/wiki/MD5)，但是这种方案会对时间平移、CD读取错误、不同的音频压缩算法或者音量调整的实现机制等情况非常敏感。使用一些类似于MD5的方法有利于迅速找到那些严格相同（从音频文件的二进制数据来看）的音频文件，但是要找到全部相同（从音频文件的内容来看）的音频文件就需要使用其他更高级的算法了。
  >
  > 那些并不紧随IT工业潮流的人往往能反其道而行之，对于那些微小差异足够健壮的散列函数确实存在。现存的绝大多数散列算法都是不够健壮的，但是有少数散列算法能够达到辨别从嘈杂房间里的扬声器里播放出来的音乐的健壮性。有一个实际的例子是[Shazam](https://zh.wikipedia.org/w/index.php?title=Shazam_Entertainment&action=edit&redlink=1)[[1\]](http://www.shazam.com/) 服务。用户可以用手机打开其app，并将话筒靠近用于播放音乐的扬声器。该项服务会分析正在播放的音乐，并将它于存储在数据库中的已知的散列值进行比较。用户就能够收到被识别的音乐的曲名。

## 数字签名

> 以下摘自阮一峰老师的博客文章《[数字签名是什么？](http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html )》

1.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080901.png)

鲍勃有两把钥匙，一把是公钥，另一把是私钥。

2.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080902.png)

鲍勃把公钥送给他的朋友们----帕蒂、道格、苏珊----每人一把。

3.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080903.png)

苏珊要给鲍勃写一封保密的信。她写完后用鲍勃的公钥加密，就可以达到保密的效果。

4.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080904.png)

鲍勃收信后，用私钥解密，就看到了信件内容。这里要强调的是，只要鲍勃的私钥不泄露，这封信就是安全的，即使落在别人手里，也无法解密。

5.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080905.png)

鲍勃给苏珊回信，决定采用"数字签名"。他写完后先用Hash函数，生成信件的摘要（digest）。

6.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080906.png)

然后，鲍勃使用私钥，对这个摘要加密，生成"数字签名"（signature）。

7.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080907.png)

鲍勃将这个签名，附在信件下面，一起发给苏珊。

8.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080908.png)

苏珊收信后，取下数字签名，用鲍勃的公钥解密，得到信件的摘要。由此证明，这封信确实是鲍勃发出的。

9.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080909.png)

苏珊再对信件本身使用Hash函数，将得到的结果，与上一步得到的摘要进行对比。如果两者一致，就证明这封信未被修改过。

10.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080910.png)

复杂的情况出现了。道格想欺骗苏珊，他偷偷使用了苏珊的电脑，用自己的公钥换走了鲍勃的公钥。此时，苏珊实际拥有的是道格的公钥，但是还以为这是鲍勃的公钥。因此，道格就可以冒充鲍勃，用自己的私钥做成"数字签名"，写信给苏珊，让苏珊用假的鲍勃公钥进行解密。

11.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080911.png)

后来，苏珊感觉不对劲，发现自己无法确定公钥是否真的属于鲍勃。她想到了一个办法，要求鲍勃去找"证书中心"（certificate authority，简称CA），为公钥做认证。证书中心用自己的私钥，对鲍勃的公钥和一些相关信息一起加密，生成"数字证书"（Digital Certificate）。

12.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080912.png)

鲍勃拿到数字证书以后，就可以放心了。以后再给苏珊写信，只要在签名的同时，再附上数字证书就行了。

13.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080913.png)

苏珊收信后，用CA的公钥解开数字证书，就可以拿到鲍勃真实的公钥了，然后就能证明"数字签名"是否真的是鲍勃签的。

14.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080914.jpg)

下面，我们看一个应用"数字证书"的实例：https协议。这个协议主要用于网页加密。

15.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080915.png)

首先，客户端向服务器发出加密请求。

16.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080916.png)

服务器用自己的私钥加密网页以后，连同本身的数字证书，一起发送给客户端。

17.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080917.png)

客户端（浏览器）的"证书管理器"，有"受信任的根证书颁发机构"列表。客户端会根据这张列表，查看解开数字证书的公钥是否在列表之内。

18.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080918.png)

如果数字证书记载的网址，与你正在浏览的网址不一致，就说明这张证书可能被冒用，浏览器会发出警告。

19.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080919.jpg)

如果这张数字证书不是由受信任的机构颁发的，浏览器会发出另一种警告。

20.

![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080920.png)

如果数字证书是可靠的，客户端就可以使用证书中的服务器公钥，对信息进行加密，然后与服务器交换加密信息。

# 技术案例

> 讲解分析开发中的实际案例技术

- 文件校验【种子，文件】
- 用户密码存储，md5，加盐【彩虹表】
- 登录、jwt、ssh【公钥登录】、单点登录、oauth2
- 金融支付【alipay、wechat】
- gmssl介绍

# 接下来（建议大家自行了解）

- 银行的认证
- 文件加密【加壳】

# 参考链接

- [Diffie-Hellman密钥交换算法论文](https://ee.stanford.edu/~hellman/publications/24.pdf )
- [阮一峰-RSA算法原理（一）](http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html )
- [阮一峰-RSA算法原理 （二）](http://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html )
- [银行密码系统安全吗？质数（素数）到底有啥用？李永乐老师11分钟讲RSA加密算法（2018最新）](https://www.bilibili.com/video/av26639065?from=search&seid=1342431877997942015)
- [手机支付中的数字签名是如何保证信息安全的？李永乐老师讲解生日碰撞和哈希函数（2018最新）](https://www.bilibili.com/video/av26024596?from=search&seid=1342431877997942015 )
- [可汗学院公开课：现代密码学](http://open.163.com/special/Khan/moderncryptography.html)
- [可汗学院-密码学之旅](https://www.khanacademy.org/computing/computer-science/cryptography?utm_source=youtube&utm_medium=linkcard )
- [国密算法](http://gmssl.org/docs/sslvpn.html )
- [阮一峰-数字签名是什么？](http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html )
- [阮一峰-JSON Web Token 入门教程](http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html )
- [阮一峰-OAuth 2.0 的一个简单解释](http://www.ruanyifeng.com/blog/2019/04/oauth_design.html )
- [阮一峰-理解OAuth 2.0](http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html )
- [阮一峰-ssh](http://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html )
